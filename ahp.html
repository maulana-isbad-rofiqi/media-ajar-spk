<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modul AHP</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <nav class="navbar navbar-dark shadow-sm">
        <div class="container">
            <a class="navbar-brand" href="index.html"><i class="fas fa-arrow-left me-2"></i> Modul AHP</a>
        </div>
    </nav>

    <div class="container my-4">
        <div class="method-header" style="border-left-color: #dc3545;">
            <h2 class="fw-bold mb-3"><i class="fas fa-sitemap text-danger me-2"></i>AHP</h2>
            <p class="text-muted">Metode hirarki dengan uji Konsistensi (CR). Jika CR < 0.1 maka input valid.</p>
        </div>

        <div class="row">
            <div class="col-lg-12 mb-4">
                <div class="step-card bg-white p-4">
                    <h5 class="fw-bold mb-3 text-center">Matriks Perbandingan Berpasangan</h5>
                    <div class="table-responsive">
                        <table class="table table-bordered text-center align-middle">
                            <thead class="table-danger">
                                <tr><th>Kriteria</th><th>Harga</th><th>Kualitas</th><th>Layanan</th></tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <th class="bg-light">Harga</th>
                                    <td><input type="text" class="form-control text-center bg-light" value="1" disabled></td>
                                    <td><input type="number" id="k1_k2" class="form-control text-center" value="3" onchange="autoFill()"></td>
                                    <td><input type="number" id="k1_k3" class="form-control text-center" value="5" onchange="autoFill()"></td>
                                </tr>
                                <tr>
                                    <th class="bg-light">Kualitas</th>
                                    <td><input type="text" id="k2_k1" class="form-control text-center bg-light" value="0.33" disabled></td>
                                    <td><input type="text" class="form-control text-center bg-light" value="1" disabled></td>
                                    <td><input type="number" id="k2_k3" class="form-control text-center" value="3" onchange="autoFill()"></td>
                                </tr>
                                <tr>
                                    <th class="bg-light">Layanan</th>
                                    <td><input type="text" id="k3_k1" class="form-control text-center bg-light" value="0.2" disabled></td>
                                    <td><input type="text" id="k3_k2" class="form-control text-center bg-light" value="0.33" disabled></td>
                                    <td><input type="text" class="form-control text-center bg-light" value="1" disabled></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <button onclick="hitungAHP()" class="btn btn-danger w-100 rounded-pill fw-bold mt-3 shadow">
                        <i class="fas fa-check-circle me-1"></i> Cek Konsistensi
                    </button>
                </div>
            </div>

            <div class="col-lg-12">
                <div id="hasil-container" class="row d-none">
                    <div class="col-md-6">
                        <div class="step-card bg-white p-3">
                            <h6 class="text-danger fw-bold">Bobot Prioritas</h6>
                            <ul class="list-group list-group-flush" id="list-bobot"></ul>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="step-card bg-white p-3 text-center">
                            <h6 class="text-danger fw-bold">Rasio Konsistensi (CR)</h6>
                            <h2 id="nilai-cr" class="fw-bold my-3"></h2>
                            <div id="status-cr"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function autoFill() {
            let k1k2 = parseFloat(document.getElementById('k1_k2').value);
            let k1k3 = parseFloat(document.getElementById('k1_k3').value);
            let k2k3 = parseFloat(document.getElementById('k2_k3').value);

            document.getElementById('k2_k1').value = (1/k1k2).toFixed(3);
            document.getElementById('k3_k1').value = (1/k1k3).toFixed(3);
            document.getElementById('k3_k2').value = (1/k2k3).toFixed(3);
        }

        function hitungAHP() {
            let mat = [
                [1, parseFloat(document.getElementById('k1_k2').value), parseFloat(document.getElementById('k1_k3').value)],
                [parseFloat(document.getElementById('k2_k1').value), 1, parseFloat(document.getElementById('k2_k3').value)],
                [parseFloat(document.getElementById('k3_k1').value), parseFloat(document.getElementById('k3_k2').value), 1]
            ];

            let totalCol = [0, 0, 0];
            for(let i=0; i<3; i++) {
                for(let j=0; j<3; j++) {
                    totalCol[j] += mat[i][j];
                }
            }

            let bobot = [0, 0, 0];
            for(let i=0; i<3; i++) {
                let sumBaris = 0;
                for(let j=0; j<3; j++) {
                    sumBaris += mat[i][j] / totalCol[j];
                }
                bobot[i] = sumBaris / 3;
            }

            let lambdaMax = 0;
            for(let i=0; i<3; i++) {
                lambdaMax += totalCol[i] * bobot[i];
            }

            let CI = (lambdaMax - 3) / 2;
            let CR = CI / 0.58;

            document.getElementById('hasil-container').classList.remove('d-none');
            
            let htmlBobot = '';
            let kriteria = ['Harga', 'Kualitas', 'Layanan'];
            for(let i=0; i<3; i++) {
                htmlBobot += `<li class="list-group-item d-flex justify-content-between">${kriteria[i]} <span>${(bobot[i]*100).toFixed(1)}%</span></li>`;
            }
            document.getElementById('list-bobot').innerHTML = htmlBobot;
            document.getElementById('nilai-cr').innerText = CR.toFixed(4);

            let statusBox = document.getElementById('status-cr');
            if(CR < 0.1) {
                statusBox.innerHTML = '<span class="badge bg-success px-3 py-2">KONSISTEN (Valid)</span>';
            } else {
                statusBox.innerHTML = '<span class="badge bg-danger px-3 py-2">TIDAK KONSISTEN</span>';
            }
        }
    </script>
</body>
</html>
